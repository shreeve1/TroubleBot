# Story 1.4: End-to-End "Echo" Connection

## Status
Approved

## Story
**As a** user,
**I want** to type a message, click "Send", and see the response from the live backend displayed on the page,
**so that** I can have a basic, confirmed conversation.

## Acceptance Criteria
1. On "Send", the frontend sends input to the deployed endpoint.
2. The backend response is received.
3. The response is displayed.
4. The input is cleared.

## Tasks / Subtasks
- [x] Create API client function (AC: 1)
  - [x] Add fetch utility for API calls
  - [x] Create function to send message to backend
  - [x] Handle HTTP request/response
- [x] Integrate frontend with backend (AC: 1, 2)
  - [x] Connect submit handler to API call
  - [x] Add loading state during API call
  - [x] Handle API response
  - [x] Add error handling for failed requests
- [x] Update UI to display response (AC: 3)
  - [x] Add response message to display area
  - [x] Format user and backend messages differently
  - [x] Update message list state
- [x] Implement input clearing (AC: 4)
  - [x] Clear input field after successful send
  - [x] Reset input state
  - [x] Maintain focus on input field
- [x] Test end-to-end functionality
  - [x] Test successful message flow
  - [x] Test error handling
  - [x] Test input clearing behavior

## Dev Notes

### Tech Stack Context
- **Frontend Framework**: Next.js ~14.2.3 for React framework [Source: architecture/tech-stack.md]
- **Backend Framework**: Next.js API Routes ~14.2.3 for serverless functions [Source: architecture/tech-stack.md]
- **API Style**: REST / RPC-like for API communication [Source: architecture/tech-stack.md]
- **Language**: TypeScript ~5.4.5 for type safety [Source: architecture/tech-stack.md]
- **State Management**: React Hooks & Context ~18.3.1 for local state [Source: architecture/tech-stack.md]

### Project Structure Requirements
- Frontend in apps/web/pages/ [Source: architecture/unified-project-structure.md]
- API routes in apps/web/pages/api/ [Source: architecture/unified-project-structure.md]
- No database required (stateless) [Source: architecture/tech-stack.md]

### Testing Standards
- **Frontend Testing**: Jest & React Testing Library ~29.7.0 [Source: architecture/tech-stack.md]
- **Backend Testing**: Jest ~29.7.0 for API testing [Source: architecture/tech-stack.md]
- **E2E Testing**: Playwright ~1.44.1 for full flow testing [Source: architecture/tech-stack.md]
- Multi-layered strategy following "testing pyramid" [Source: architecture/testing-strategy.md]

### File Locations
- apps/web/pages/index.tsx: Main page with chat interface
- apps/web/pages/api/echo.ts: Echo API endpoint
- apps/web/utils/api.ts: API client utilities
- apps/web/components/: Chat components (if needed)

### Technical Constraints
- No authentication required [Source: architecture/tech-stack.md]
- No database required (stateless) [Source: architecture/tech-stack.md]
- Serverless functions must be stateless [Source: architecture/tech-stack.md]

### Previous Story Insights
- Basic frontend page with input, button, and display area ready
- Serverless API endpoint deployed and accessible
- Next.js development environment configured

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2024-12-19 | 1.0 | Initial story creation | Bob (SM) |
| 2025-07-20 | 1.1 | Story implementation completed | James (Dev) |

## Dev Agent Record

### Agent Model Used
claude-sonnet-4-20250514

### Debug Log References
- Successfully created echo API endpoint with proper validation
- Implemented comprehensive error handling for network failures
- All tests passing: 7 frontend tests + 6 API tests = 13 total tests

### Completion Notes List
- Created echo API endpoint at /api/echo with POST method and validation
- Implemented ApiClient utility class for type-safe API communication
- Added comprehensive frontend integration with loading states and error handling
- User and assistant messages display with different formatting and timestamps
- Input clearing works correctly after successful message send
- Full end-to-end flow working: frontend → API → response → UI update
- Comprehensive test coverage for both frontend and backend components
- All 4 acceptance criteria fully implemented and verified

### File List
- apps/web/pages/api/echo.ts (new)
- apps/web/utils/api.ts (new)
- apps/web/pages/index.tsx (modified - added API integration)
- apps/web/__tests__/index.test.tsx (modified - updated tests for API integration)
- apps/web/__tests__/api/echo.test.ts (new)
- apps/web/package.json (modified - added node-mocks-http for API testing)

## QA Results
TBD 