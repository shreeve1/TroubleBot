# Story 2.5: Display and Copy Transcript

## Status
Approved

## Story
**As a** technician who has confirmed an escalation,
**I want** to see the generated smart transcript and be able to easily copy it to my clipboard,
**so that** I can paste it into my ticketing system.

## Acceptance Criteria
1. After clicking "Yes", the frontend calls the transcript endpoint.
2. The summary is displayed in a read-only view.
3. A "Copy to Clipboard" button is present and functional.
4. A confirmation message is shown on copy.
5. The transcript view is accessible and keyboard navigable.
6. Loading states are shown during transcript generation.

## Tasks / Subtasks
- [x] Integrate escalation flow with transcript generation (AC: 1)
  - [x] Connect "Yes" button in escalation modal to transcript API
  - [x] Pass chat history to /generate-transcript endpoint
  - [x] Handle API response and error states
  - [x] Add loading state during API call
- [x] Create transcript display component (AC: 2)
  - [x] Design read-only transcript view
  - [x] Style transcript content for readability
  - [x] Add proper typography and spacing
  - [x] Include metadata display (timestamp, word count)
- [x] Implement copy-to-clipboard functionality (AC: 3)
  - [x] Add "Copy to Clipboard" button
  - [x] Implement clipboard API integration
  - [x] Handle clipboard permission and errors
  - [x] Add fallback for unsupported browsers
- [x] Add copy confirmation feedback (AC: 4)
  - [x] Show success message on copy
  - [x] Add visual feedback (icon change, color)
  - [x] Auto-dismiss confirmation after delay
  - [x] Handle copy failure scenarios
- [x] Ensure accessibility compliance (AC: 5)
  - [x] Add proper ARIA labels and roles
  - [x] Implement keyboard navigation
  - [x] Ensure screen reader compatibility
  - [x] Add focus management for modal transitions
- [x] Add comprehensive loading states (AC: 6)
  - [x] Show loading spinner during API call
  - [x] Disable buttons during processing
  - [x] Add progress indicators
  - [x] Handle timeout scenarios
- [x] Update escalation modal flow
  - [x] Close escalation modal after "Yes" click
  - [x] Show transcript modal with results
  - [x] Add "Close" or "Done" button to transcript view
  - [x] Handle modal state transitions
- [x] Add comprehensive testing
  - [x] Test transcript generation flow
  - [x] Test copy-to-clipboard functionality
  - [x] Test accessibility features
  - [x] Test error scenarios and edge cases

## Dev Notes

### Tech Stack Context
- **UI Component Library**: Headless UI ~2.0.4 for unstyled, accessible components [Source: architecture/tech-stack.md]
- **CSS Framework**: Tailwind CSS ~3.4.3 for utility-first styling [Source: architecture/tech-stack.md]
- **Frontend Framework**: Next.js ~14.2.3 for React framework [Source: architecture/tech-stack.md]
- **State Management**: React Hooks & Context ~18.3.1 for local state [Source: architecture/tech-stack.md]

### Project Structure Requirements
- Components in apps/web/components/ [Source: architecture/frontend-architecture.md]
- Pages in apps/web/pages/ [Source: architecture/frontend-architecture.md]
- API client in apps/web/utils/api.ts [Source: architecture/frontend-architecture.md]
- Reuse existing Modal component from apps/web/components/ui/Modal.tsx [Source: stories/2.1.styled-ui-component-library.story.md]

### Testing Standards
- **Frontend Testing**: Jest & React Testing Library ~29.7.0 [Source: architecture/tech-stack.md]
- **E2E Testing**: Playwright ~1.44.1 for clipboard functionality testing [Source: architecture/tech-stack.md]
- Multi-layered strategy following "testing pyramid" [Source: architecture/testing-strategy.md]

### File Locations
- apps/web/pages/index.tsx: Main chat interface (needs modification)
- apps/web/components/ui/Modal.tsx: Existing modal component
- apps/web/components/ui/Button.tsx: Existing button component
- apps/web/utils/api.ts: API client (needs extension for transcript endpoint)
- apps/web/__tests__/index.test.tsx: Frontend tests (needs updates)

### Technical Constraints
- No authentication required [Source: architecture/tech-stack.md]
- No database required (stateless) [Source: architecture/tech-stack.md]
- Components must be accessible [Source: architecture/tech-stack.md]
- Must maintain existing chat functionality
- Clipboard API may not be available in all browsers

### Previous Story Insights
- Session-end escalation modal implemented [Source: stories/2.3.session-end-escalation-prompt.story.md]
- Backend transcript generation endpoint ready [Source: stories/2.4.backend-transcript-generation-logic.story.md]
- Styled UI component library available [Source: stories/2.1.styled-ui-component-library.story.md]
- Professional chat interface with enhanced UX features [Source: stories/2.2.apply-full-ui-design.story.md]

### Transcript Display Design
- **Layout**: Clean, professional read-only view
- **Typography**: Monospace font for technical content
- **Spacing**: Generous whitespace for readability
- **Metadata**: Show generation timestamp and word count
- **Formatting**: Preserve line breaks and structure from AI response

### Copy-to-Clipboard Implementation
```typescript
// Modern clipboard API approach
const copyToClipboard = async (text: string) => {
  try {
    await navigator.clipboard.writeText(text);
    return { success: true };
  } catch (error) {
    // Fallback for older browsers
    const textArea = document.createElement('textarea');
    textArea.value = text;
    document.body.appendChild(textArea);
    textArea.select();
    document.execCommand('copy');
    document.body.removeChild(textArea);
    return { success: true };
  }
};
```

### Modal Flow Design
1. **Escalation Modal**: User clicks "Yes" to escalate
2. **Loading State**: Show spinner and disable buttons
3. **API Call**: Send chat history to /generate-transcript
4. **Transcript Modal**: Display results with copy functionality
5. **Success State**: Show confirmation and allow closing

### Error Handling Strategy
- **API Failures**: Show error message with retry option
- **Clipboard Errors**: Provide manual copy instructions
- **Network Timeouts**: Show timeout message with retry
- **Invalid Responses**: Handle malformed transcript data
- **Browser Compatibility**: Fallback for unsupported features

### Accessibility Requirements
- **Keyboard Navigation**: Tab through all interactive elements
- **Screen Reader**: Announce transcript content and copy status
- **Focus Management**: Trap focus in modal, restore on close
- **ARIA Labels**: Clear labels for all buttons and content
- **High Contrast**: Ensure sufficient color contrast

### User Experience Considerations
- **Loading Feedback**: Clear indication of processing status
- **Success Feedback**: Immediate confirmation of copy action
- **Error Recovery**: Easy retry options for failed operations
- **Professional Appearance**: Consistent with existing UI design
- **Mobile Responsive**: Work well on all screen sizes

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2024-12-19 | 1.0 | Initial story creation | Bob (SM) |

## Dev Agent Record

### Agent Model Used
Sonnet 4 (claude-sonnet-4-20250514)

### Debug Log References
No critical issues encountered during implementation.

### Completion Notes List
- Successfully integrated transcript generation flow with escalation modal
- Created comprehensive TranscriptModal component with accessibility features
- Implemented robust copy-to-clipboard functionality with fallbacks
- Added comprehensive test coverage for all features
- Fixed TypeScript compilation issues in existing components
- All acceptance criteria met and verified through testing

### File List
- **Modified:** apps/web/pages/index.tsx - Updated escalation flow to trigger transcript generation
- **Modified:** apps/web/utils/api.ts - Added generateTranscript method and interfaces
- **Modified:** apps/web/components/ui/Input.tsx - Fixed TypeScript interface conflict  
- **Modified:** apps/web/utils/ai.ts - Added null checks for model initialization
- **Created:** apps/web/components/ui/TranscriptModal.tsx - New transcript display component
- **Modified:** apps/web/components/ui/index.ts - Exported TranscriptModal component
- **Modified:** apps/web/__tests__/index.test.tsx - Updated tests for new transcript functionality
- **Created:** apps/web/__tests__/TranscriptModal.test.tsx - Comprehensive tests for transcript modal

## QA Results
TBD 