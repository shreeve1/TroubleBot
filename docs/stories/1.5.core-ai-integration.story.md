# Story 1.5: Core AI Integration

## Status
Draft

## Story
**As a** user,
**I want** the backend to process my message using the pre-loaded Gemini instruction set and return the AI's actual response,
**so that** I can interact with the specialized troubleshooting assistant.

## Acceptance Criteria
1. The serverless function integrates with the Gemini API.
2. The function is configured with the static instruction prompt.
3. The user's message is passed to the Gemini API.
4. The AI's response is returned and displayed.

## Tasks / Subtasks
- [ ] Set up Gemini API integration (AC: 1)
  - [ ] Install Google AI SDK for Gemini
  - [ ] Configure API key environment variable
  - [ ] Create Gemini client configuration
  - [ ] Add error handling for API failures
- [ ] Implement static instruction prompt (AC: 2)
  - [ ] Create instruction prompt configuration
  - [ ] Load troubleshooting assistant instructions
  - [ ] Configure prompt template
  - [ ] Add prompt to API route
- [ ] Create AI processing endpoint (AC: 3)
  - [ ] Create new API route for AI chat
  - [ ] Implement message processing logic
  - [ ] Combine user message with instruction prompt
  - [ ] Send to Gemini API
- [ ] Handle AI response (AC: 4)
  - [ ] Process Gemini API response
  - [ ] Format response for frontend
  - [ ] Return structured JSON response
  - [ ] Add error handling for malformed responses
- [ ] Update frontend to use AI endpoint
  - [ ] Modify API client to call AI endpoint
  - [ ] Update message display for AI responses
  - [ ] Test AI conversation flow

## Dev Notes

### Tech Stack Context
- **Backend Framework**: Next.js API Routes ~14.2.3 for serverless functions [Source: architecture/tech-stack.md]
- **Language**: TypeScript ~5.4.5 for type-safe serverless functions [Source: architecture/tech-stack.md]
- **API Style**: REST / RPC-like for API communication [Source: architecture/tech-stack.md]
- **External APIs**: Gemini API for AI processing [Source: architecture/tech-stack.md]
- **Logging**: Vercel Log Drains for serverless function logs [Source: architecture/tech-stack.md]

### Project Structure Requirements
- API routes in apps/web/pages/api/ [Source: architecture/unified-project-structure.md]
- No database required (stateless) [Source: architecture/tech-stack.md]
- No authentication required [Source: architecture/tech-stack.md]

### Testing Standards
- **Backend Testing**: Jest ~29.7.0 for API testing [Source: architecture/tech-stack.md]
- **E2E Testing**: Playwright ~1.44.1 for AI conversation testing [Source: architecture/tech-stack.md]
- Multi-layered strategy following "testing pyramid" [Source: architecture/testing-strategy.md]

### File Locations
- apps/web/pages/api/chat.ts: AI chat endpoint
- apps/web/config/gemini.ts: Gemini API configuration
- apps/web/utils/ai.ts: AI processing utilities
- .env.local: Environment variables for API keys

### Technical Constraints
- Serverless functions must be stateless [Source: architecture/tech-stack.md]
- No persistent data storage required [Source: architecture/tech-stack.md]
- External API integration with Gemini required
- Environment variables for API keys needed

### Previous Story Insights
- End-to-end connection between frontend and backend established
- API client utilities ready for integration
- Message display and input handling functional

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2024-12-19 | 1.0 | Initial story creation | Bob (SM) |

## Dev Agent Record

### Agent Model Used
TBD

### Debug Log References
TBD

### Completion Notes List
TBD

### File List
TBD

## QA Results
TBD 